// Generated by CoffeeScript 1.7.1
(function() {
  var IDSet, SetIndex;

  IDSet = require('../id_set');

  SetIndex = (function() {
    function SetIndex() {
      this._map = {};
    }

    SetIndex.prototype.add = function(id, key) {
      var keys, _i, _len;
      keys = key instanceof Array ? key : [key];
      for (_i = 0, _len = keys.length; _i < _len; _i++) {
        key = keys[_i];
        if (this._map[key] == null) {
          this._map[key] = new IDSet();
        }
        this._map[key].add(id);
      }
      return null;
    };

    SetIndex.prototype.search = function(keys) {
      var key, sets;
      if (this._map[keys] != null) {
        return this._map[keys].clone();
      } else {
        if (!(keys instanceof Array)) {
          return new IDSet();
        }
      }
      sets = (function() {
        var _i, _len, _results;
        _results = [];
        for (_i = 0, _len = keys.length; _i < _len; _i++) {
          key = keys[_i];
          if (this._map[key] != null) {
            _results.push(this._map[key]);
          }
        }
        return _results;
      }).call(this);
      return IDSet.union(sets);
    };

    return SetIndex;

  })();

  module.exports = SetIndex;

}).call(this);
